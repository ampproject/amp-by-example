!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";function r(t){return"[object Array]"==Object.prototype.toString.call(t)}function e(r){var e=r.doc.modeOption;return"sql"===e&&(e="text/x-sql"),t.resolveMode(e).keywords}function n(t){return"string"==typeof t?t:t.text}function o(t,e){return r(e)&&(e={columns:e}),e.text||(e.text=t),e}function i(t){var e={};if(r(t))for(var i=t.length-1;i>=0;i--){var s=t[i];e[n(s).toUpperCase()]=o(n(s),s)}else if(t)for(var a in t)e[a.toUpperCase()]=o(a,t[a]);return e}function s(t){return x[t.toUpperCase()]}function a(t){var r={};for(var e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return r}function u(t,r){var e=t.length,o=n(r).substr(0,e);return t.toUpperCase()===o.toUpperCase()}function f(t,e,n,o){if(r(n))for(var i=0;i<n.length;i++)u(e,n[i])&&t.push(o(n[i]));else for(var s in n)if(n.hasOwnProperty(s)){var a=n[s];a=a&&a!==!0?a.displayText?{text:a.text,displayText:a.displayText}:a.text:s,u(e,a)&&t.push(o(a))}}function l(t){return"."==t.charAt(0)&&(t=t.substr(1)),t.replace(/`/g,"")}function c(t){for(var r=n(t).split("."),e=0;e<r.length;e++)r[e]="`"+r[e]+"`";var o=r.join(".");return"string"==typeof t?o:(t=a(t),t.text=o,t)}function p(t,r,e,n){for(var o=!1,i=[],u=r.start,p=!0;p;)p="."==r.string.charAt(0),o=o||"`"==r.string.charAt(0),u=r.start,i.unshift(l(r.string)),r=n.getTokenAt(b(t.line,r.start)),"."==r.string&&(p=!0,r=n.getTokenAt(b(t.line,r.start)));var g=i.join(".");f(e,g,x,function(t){return o?c(t):t}),f(e,g,m,function(t){return o?c(t):t}),g=i.pop();var d=i.join("."),h=!1,y=d;if(!s(d)){var A=d;d=v(d,n),d!==A&&(h=!0)}var C=s(d);return C&&C.columns&&(C=C.columns),C&&f(e,g,C,function(t){var r=d;return 1==h&&(r=y),"string"==typeof t?t=r+"."+t:(t=a(t),t.text=r+"."+t.text),o?c(t):t}),u}function g(t,r){if(t)for(var e=/[,;]/g,n=t.split(" "),o=0;o<n.length;o++)r(n[o]?n[o].replace(e,""):"")}function d(t){return t.line+t.ch/Math.pow(10,6)}function h(t){return b(Math.floor(t),+t.toString().split(".").pop())}function v(t,r){for(var e=r.doc,n=e.getValue(),o=t.toUpperCase(),i="",a="",u=[],f={start:b(0,0),end:b(r.lastLine(),r.getLineHandle(r.lastLine()).length)},l=n.indexOf(A.QUERY_DIV);l!=-1;)u.push(e.posFromIndex(l)),l=n.indexOf(A.QUERY_DIV,l+1);u.unshift(b(0,0)),u.push(b(r.lastLine(),r.getLineHandle(r.lastLine()).text.length));for(var c=0,p=d(r.getCursor()),v=0;v<u.length;v++){var x=d(u[v]);if(p>c&&p<=x){f={start:h(c),end:h(x)};break}c=x}for(var m=e.getRange(f.start,f.end,!1),v=0;v<m.length;v++){var y=m[v];if(g(y,function(t){var r=t.toUpperCase();r===o&&s(i)&&(a=i),r!==A.ALIAS_KEYWORD&&(i=t)}),a)break}return a}var x,m,y,A={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},b=t.Pos;t.registerHelper("hint","sql",function(t,r){x=i(r&&r.tables);var n=r&&r.defaultTable,o=r&&r.disableKeywords;m=n&&s(n),y=e(t),n&&!m&&(m=v(n,t)),m=m||[],m.columns&&(m=m.columns);var a,u,l,c=t.getCursor(),g=[],d=t.getTokenAt(c);return d.end>c.ch&&(d.end=c.ch,d.string=d.string.slice(0,c.ch-d.start)),d.string.match(/^[.`\w@]\w*$/)?(l=d.string,a=d.start,u=d.end):(a=u=c.ch,l=""),"."==l.charAt(0)||"`"==l.charAt(0)?a=p(c,d,g,t):(f(g,l,x,function(t){return t}),f(g,l,m,function(t){return t}),o||f(g,l,y,function(t){return t.toUpperCase()})),{list:g,from:b(c.line,a),to:b(c.line,u)}})});